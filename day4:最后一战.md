# 训练与测试
## 模型训练
前面的章节，我们已经对目标检测训练的各个重要的知识点进行了讲解，下面我们需要将整个流程串起来，对模型进行训练。

目标检测网络的训练大致是如下的流程：

· 设置各种超参数

· 定义数据加载模块 dataloader

· 定义网络 model

· 定义损失函数 loss

· 定义优化器 optimizer

· 遍历训练数据，预测-计算loss-反向传播

## 后处理
### 目标框信息解码
之前我们的提到过，模型不是直接预测的目标框信息，而是预测的基于anchor的偏移，且经过了编码。因此后处理的第一步，就是对模型的回归头的输出进行解码，拿到真正意义上的目标框的预测结果。

后处理还需要做什么呢？由于我们预设了大量的先验框，因此预测时在目标周围会形成大量高度重合的检测框，而我们目标检测的结果只希望保留一个足够准确的预测框，所以就需要使用某些算法对检测框去重。这个去重算法叫做NMS，下面我们详细来讲一讲。

### NMS非极大值抑制
NMS的大致算法步骤如下：

1. 按照类别分组，依次遍历每个类别。

2. 当前类别按分类置信度排序，并且设置一个最低置信度阈值如0.05，低于这个阈值的目标框直接舍弃。

3. 当前概率最高的框作为候选框，其它所有与候选框的IOU高于一个阈值（自己设定，如0.5）的框认为需要被抑制，从剩余框数组中删除。

4. 然后在剩余的框里寻找概率第二大的框，其它所有与第二大的框的IOU高于设定阈值的框被抑制。

5. 依次类推重复这个过程，直至遍历完所有剩余框，所有没被抑制的框即为最终检测框。

![](https://raw.githubusercontent.com/datawhalechina/dive-into-cv-pytorch/master/markdown_imgs/chapter03/3-29.png)

# 总结
实际上这一块还是常规的内容偏多，最主要的问题是代码也已经编写好。其实有个建议就是以后的开源学习可以准备两份代码，一份是类似于现在这样子全部写好的。另一份是类似于
吴恩达和李宏毅的那种，大体写好了，剩下关键的部分要自己去写的那种，也可以放GitHub也可以直接分享一个colab/阿里云的文档
我觉得会有比较好的效果。因为现在这样对于没有计算资源的来说，重新吧代码一块块搬到colab也是一件边际效应很低的事情。

最后谢谢你萌的开源，希望以后没那么菜了也能加入你们
